<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Chat Test</title>
</head>
<body>
<h2>Тест Чата</h2>
<input type="text" id="email" placeholder="Твой email (User1)">
<button onclick="connect()">Подключиться</button>
<hr>

<div id="status" style="color:red">Отключено</div>

<div id="messages" style="border:1px solid #ccc; height:300px; overflow-y:scroll; margin: 10px 0;"></div>

<input type="text" id="msg" placeholder="Сообщение..." disabled>
<button id="sendBtn" onclick="send()" disabled>Отправить</button>

<script>
    let socket;

    function connect() {
        const email = document.getElementById("email").value;
        if (!email) return alert("Введите email!");

        // Открываем WebSocket соединение
        // Передаем email в параметрах запроса
        socket = new WebSocket("ws://localhost:8080/ws?email=" + email);

        socket.onopen = () => {
            document.getElementById("status").innerText = "Подключено: " + email;
            document.getElementById("status").style.color = "green";
            document.getElementById("msg").disabled = false;
            document.getElementById("sendBtn").disabled = false;
        };

        socket.onmessage = (event) => {
            // Сервер присылает JSON, парсим его
            const msg = JSON.parse(event.data);
            const div = document.createElement("div");
            // Формат: [Email]: Текст
            div.innerText = `[${msg.sender}]: ${msg.content}`;
            document.getElementById("messages").appendChild(div);
        };

        socket.onclose = () => {
            document.getElementById("status").innerText = "Отключено";
            document.getElementById("status").style.color = "red";
        };
    }

    function send() {
        const input = document.getElementById("msg");
        if (!socket || socket.readyState !== WebSocket.OPEN) return;

        // Отправляем просто текст, сервер сам обернет его в JSON и добавит sender
        socket.send(input.value);
        input.value = "";
    }
</script>
</body>
</html>